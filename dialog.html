<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…</title>

<style>
  body {
    font-family: "Cairo", sans-serif;
    background: #f3f4f6;
    text-align: center;
    padding: 50px;
  }

  /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø§ÙØ°Ø© */
  .dialog-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(3px);
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  /* Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
  .dialog-box {
    background: #fff;
    border-radius: 18px;
    padding: 25px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    animation: slideUp 0.4s ease;
    text-align: right;
  }

  .dialog-header {
    font-size: 20px;
    font-weight: 700;
    color: #222;
    text-align: center;
  }

  .toggle-btn {
    background: #2563eb;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 15px;
    font-size: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    transition: all 0.3s ease;
  }

  .toggle-btn:hover {
    background: #1d4ed8;
    transform: scale(1.03);
  }

  .arrow {
    transition: transform 0.3s ease;
  }

  .arrow.rotate {
    transform: rotate(180deg);
  }

  .course-list {
    margin-top: 15px;
    display: none; 
    border-top: 1px solid #ddd;
    padding-top: 10px;
    
    /* ------------------------------------- */
    /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    max-height: 250px; /* ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡) */
    overflow-y: auto;   /* ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ Ø¹Ù†Ø¯ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ */
    padding-right: 5px; /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„ØªØ¬Ù†Ø¨ ØªØ¯Ø§Ø®Ù„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    /* ------------------------------------- */
  }

  .course-item {
    background: #f9fafb;
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªÙØ¹ÙŠÙ„ Flexbox Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¬Ø§Ù†Ø¨Ø§Ù‹ Ù„Ø¬Ø§Ù†Ø¨ */
    display: flex; 
    justify-content: space-between; /* Ø¯ÙØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø·Ø±Ø§Ù */
    align-items: center;
  }

  .course-item:hover {
    background: #e0e7ff;
    color: #1e40af;
  }

  .message {
    text-align: center;
    margin-top: 12px;
    color: #16a34a;
    font-weight: 600;
    display: none;
    padding: 10px;
    border: 1px solid #c8e6c9;
    background: #f1fff1;
    border-radius: 8px;
  }

  /* Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³ÙˆÙ… Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± */
  .levies-text-red {
    color: #ef4444; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙˆØ§Ø¶Ø­ */
    font-weight: 700;
    font-size: 15px;
    background: #fee2e2; /* Ø®Ù„ÙÙŠØ© Ø­Ù…Ø±Ø§Ø¡ ÙØ§ØªØ­Ø© */
    padding: 3px 8px;
    border-radius: 6px;
  }


  .close-btn {
    background: #ef4444;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 20px;
    display: block;
    width: 100%;
  }

  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  @keyframes slideUp { from {transform:translateY(30px);opacity:0;} to {transform:translateY(0);opacity:1;} }
</style>
</head>

<body>

<div class="dialog-overlay" id="dialogOverlay">
  <div class="dialog-box">
    <div class="dialog-header">ğŸ“Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ³ÙˆÙ‚ Ù„Ù‡Ø§ </div>
    <button class="toggle-btn" id="toggleButton">
      Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª <span class="arrow" id="arrow">ğŸ”»</span>
    </button>

    <div class="course-list" id="courseList">
      </div>

    <div class="message" id="message">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…</div>
    <button class="close-btn" id="closeButton">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
// â›”â›”â›” Ù‡Ø§Ù…: ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ù†Ø´Ø± Google Apps Script â›”â›”â›”
const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxvaDty4OhXdnR3poYEuwj9W53esn2923XYpKZc7LTKf_M17Z576YGP_EkjB9bt-hN8pA/exec";

let COURSES = []; // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø¢Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©


// ====== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ======

/**
 * 1. Ø§Ø³ØªØ®Ù„Ø§Øµ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘ÙÙ‚ Ù…Ù† Ø±Ø§Ø¨Ø· URL Ø§Ù„Ø­Ø§Ù„ÙŠ
 * @returns {string} Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘ÙÙ‚ Ø£Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© TTTTTT11
 */
function getMarketerIdFromUrl() {
    const fallbackId = 'TTTTTT11';
    const urlParams = new URLSearchParams(window.location.search);
    
    return urlParams.get('marketer_id') || urlParams.get('id') || fallbackId;
}

const marketerId = getMarketerIdFromUrl();


/**
 * 2. Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù† Google Sheets API
 */
async function fetchCourses() {
    const listContainer = document.getElementById('courseList');
    listContainer.innerHTML = '<div style="text-align:center; padding: 20px; color:#555;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª...</div>';
    listContainer.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„

    try {
        const response = await fetch(APP_SCRIPT_URL);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
        if (data && data.courses && Array.isArray(data.courses)) {
            COURSES = data.courses; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            renderCourseList(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¬Ù„ÙˆØ¨Ø©
        } else {
            throw new Error("ØªÙ†Ø³ÙŠÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….");
        }
    } catch (error) {
        console.error("Error fetching courses:", error);
        listContainer.innerHTML = '<div style="text-align:center; padding: 20px; color:#ef4444;">âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø§Ø¨Ø· Apps Script.</div>';
    }
}


/**
 * 3. Ø¨Ù†Ø§Ø¡ ÙˆØ¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ… Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙˆØ§Ù„Ø¯ÙˆÙ„Ø§Ø±)
 */
function renderCourseList() {
    const listContainer = document.getElementById('courseList');
    listContainer.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

    if (COURSES.length === 0) {
         listContainer.innerHTML = '<div style="text-align:center; padding: 20px; color:#555;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
         return;
    }

    COURSES.forEach(course => {
        const item = document.createElement('div');
        item.className = 'course-item';
        
        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙˆØ±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±
        item.innerHTML = `
          <span>${course.name}</span>
          <span class="levies-text-red">Ø§Ù„Ø±Ø³ÙˆÙ…: ${course.levies} $</span>
        `;
        
        // Ù†Ø³ØªØ®Ø¯Ù… course.slug Ø§Ù„Ø°ÙŠ Ù‡Ùˆ ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ A (id)
        item.setAttribute('onclick', `copyLink('${course.slug}')`); 
        listContainer.appendChild(item);
    });
}

/**
 * 4. ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø¹Ø±Ø¶ ÙˆØ¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª
 */
function toggleList() {
    const list = document.getElementById('courseList');
    const arrow = document.getElementById('arrow');
    const isVisible = list.style.display === 'block';
    
    list.style.display = isVisible ? 'none' : 'block';
    arrow.classList.toggle('rotate');

    // Ø¥Ø°Ø§ ØªÙ… ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§
    if (!isVisible && COURSES.length === 0) {
        fetchCourses();
    }
}


/**
 * 5. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘ÙÙ‚
 * @param {string} courseSlug - Ø§Ù„Ù€ slug Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¯ÙˆØ±Ø© (Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ A/id)
 */
function copyLink(courseSlug) {
    // ğŸ”— Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
    const baseUrl = "https://skillia.netlify.app/course.html"; 
    
    // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙˆØ±Ø© Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµØ­ÙŠØ­: ?id=SLUG&marketer_id=CODE
    let fullLink = baseUrl + "?id=" + courseSlug;

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘ÙÙ‚ ÙƒØ¨Ø§Ø±Ø§Ù…ØªØ± Ø«Ø§Ù†Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ø·Ù '&'
    fullLink += "&marketer_id=" + marketerId;
    
    navigator.clipboard.writeText(fullLink).then(() => {
        const msg = document.getElementById('message');
        msg.style.display = 'block';
        msg.innerHTML = `ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙˆØ±Ø© <span style="font-weight: bold; color: #1d4ed8;">${courseSlug.toUpperCase()}</span> Ø¨Ù†Ø¬Ø§Ø­!<br> ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯Ùƒ: <span style="font-weight: bold;">${marketerId}</span> âœ…`;
        setTimeout(() => msg.style.display = 'none', 3000);
    });
}

/**
 * 6. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
 */
function closeDialog() {
    document.getElementById('dialogOverlay').style.display = 'none';
}



/**
 * 7. Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
 */
function initializeDialog() {
    // 1. ØªØ­Ø¯ÙŠØ« Ø±Ø£Ø³ Ø§Ù„Ø¯Ø§ÙŠÙ„ÙˆØ¬ Ù„Ø¹Ø±Ø¶ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ÙˆÙ‘ÙÙ‚
    const header = document.querySelector('.dialog-header');
    header.innerHTML = `ğŸ“Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ³ÙˆÙ‚ Ù„Ù‡Ø§ (ÙƒÙˆØ¯Ùƒ: <span style="color:#2563eb;">${marketerId}</span>)`;
    
    // 2. Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø§ÙŠÙ„ÙˆØ¬
    document.getElementById('dialogOverlay').style.display = 'flex';

    // 3. Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙˆØ²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Event Listeners
    document.getElementById('closeButton').addEventListener('click', closeDialog);
    
    // 4. Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª)
    document.getElementById('toggleButton').addEventListener('click', toggleList);

    // 5. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ toggleList)
    //fetchCourses();
}


// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù…Ù† dialog.js
window.onload = initializeDialog; 
</script>

</body>
</html>
